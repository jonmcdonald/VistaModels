<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
    <meta name="GENERATOR" content="Quadralay WebWorks AutoMap 2003 for FrameMaker 8.0.2.1385" />
    <meta name="TEMPLATEBASE" content="mgc_ww_v2.1.078" />
    <meta name="LASTUPDATED" content="Tue Nov 27 10:01:17 2012" />
    <meta name="mgc_html_doctitle" content="Vista User's Manual" />
    <title>Timing and Power Policies</title>
<!-- Search Engine keywords -->
    <meta name="attributes" content=" doc.type.documentation.user,doc.type.documentation.ref,product.version.v3.5,product.name.vista"/>
<!-- JavaScript Files -->
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/context.js"></script>
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/js/file_list.js"></script>
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/js/breadcrumbs.js"></script>
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/js/docvars.js"></script>
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/towwhdir.js"></script>
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/wwhpagef.js"></script>
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/topics.js"></script>
    <script type="text/javascript" language="JavaScript1.2" src="wwhelp/wwhimpl/common/scripts/popup_window.js"></script>
    <script type="text/javascript" language="JavaScript1.2" src="scripts/expand.js"></script>
    <script type="text/javascript" language="JavaScript1.2">
    <!--
      // Set reference to top level help frame
      //
      if (( window.name != "SearchTopic") && ( window.name != "PopupTopic"))
      {   var  WWHFrame = WWHGetWWHFrame(  ""); }
      else
      { var WWHFrame = eval("parent.parent"); }
      // -->
    </script>
    <script type="text/javascript" language="JavaScript1.2">
    <!--
    var  WWHFrame = eval("parent.parent");
	document.write(MGCGetInternalStyleSheet(1));
	document.write(MGCGetDocumentStyleSheet(0));
	document.write(MGCGetPGFStyleSheet(0));
    // -->
    </script>
  </head>


<body class="body" rightmargin="25" onLoad="WWHUpdate();" onUnload="WWHUnload();" onKeyDown="WWHHandleKeyDown((document.all||document.getElementById||document.layers)?event:null);" onKeyPress="WWHHandleKeyPress((document.all||document.getElementById||document.layers)?event:null);" onKeyUp="WWHHandleKeyUp((document.all||document.getElementById||document.layers)?event:null);">





 <script type="text/javascript" language="JavaScript1.2">
    <!--
      MGCInsertRTHeader(126);
    // -->
 </script>
 

<!--96,124,126-->
<!--EnDhEaDeR-->

<a name="MGCCIDPTiming and Power Policies"></a>

<a name="wp33032"></a><h4 class="pHeading3">
  


Timing and Power Policies<a name="MGCCIDMHELP_MODEL_TIMING"></a><a name="MGCCIDM5"></a>
  </h4>


<!--TimingandPowerPolicies-->


<a name="wp17838"></a><p class="pBody">
There are four types of timing and power policies that you can define in Vista:
</p>


<a name="wp17839"></a>
<ul><li class="LL1BulSolid"><span style=" font-weight: bold;">Delay</span> and <span style=" font-weight: bold;">Split</span> policies represent the timing and power policies for communication. They apply to a specific port.</li></ul>
<a name="wp91152"></a>
<ul><li class="LL1BulSolid"><span style=" font-weight: bold;">Sequential </span><span style=" font-weight: regular; font-angle: normal;">and </span><span style=" font-weight: bold;">Pipeline </span>policies represent the timing and power policies for the internal operations of a model. They apply to the relationship between ports or PV events. PV/T synchronization can be specified for these types of policies. Whenever a PV event occurs, the previous PV events are searched in order to find a cause for it according to the set Sequential and Pipeline policies. If no matching policy is found an implicit Sequential policy with zero latency is assumed from the last preceding PV event.</li></ul>
<br clear="all" />
<table border="0" cellpadding="0" cellspacing="0" width="80%" align="center">
  <tr valign="baseline">
    <td width="50" valign="top" background="wwhelp/wwhimpl/common/images/nbrule_upper.jpg">&#160;</td>
    <td background="wwhelp/wwhimpl/common/images/nbrule_upper.jpg"><span class="cNotesBlack">Note</span></td>
  </tr>
  <tr valign="top">
    <td width="50" valign="top"><img src="wwhelp/wwhimpl/common/images/nicon_note.jpg" /></td>
    <td valign="top">
            
<a name="wp91161"></a><p class="pnoteNote">
        	This applies to the timing and power for the internal architecture of a model; additional timing and power derived from the use of bus and protocol are &ldquo;consumed&rdquo; during simulation.
        </p>

          </td>
  </tr>
  <tr height="2">
    <td height="2" background="wwhelp/wwhimpl/common/images/nbrule_bottom.jpg"><img src="wwhelp/wwhimpl/common/images/nbrule_bottom.jpg" align="left" /></td>
    <td height="2" background="wwhelp/wwhimpl/common/images/nbrule_bottom.jpg"><img src="wwhelp/wwhimpl/common/images/nbrule_bottom.jpg" align="right" /></td>
    </tr>
 </table>



<a name="wp54204"></a><p class="pFigureTitle">
Figure 7&#8209;19. 


T tab - Timing &amp; Power Policies


</p>
<div align="center"><img src="images/ModelTimingTtab.gif" id="wp54202" border="0" hspace="0" vspace="0"/></div><p class="pFigureTitle">





</p>



<a name="wp54205"></a><p class="pBody">
<span class="cP12"><span style=" font-weight: bold; font-angle: normal; vertical-align: baseline; color:#000000;">To specify timing &amp; power policies:</span></span>
</p>


<a name="wp17846"></a>
<ol start="1."><li class="LL1Seq">Select the model for which to define policies.</li></ol>
<a name="wp42753"></a>
<ol start="2."><li class="LL1Seq">In<span style=" font-weight: bold;"> </span>the modeling dialog, select the <span style=" font-weight: bold;">T</span> tab then select the <span style=" font-weight: bold;">Timing &amp; Power </span>tab.</li></ol>
<a name="wp42754"></a>
<ol start="3."><li class="LL1Seq">In the <span style=" font-weight: bold;">Synchronize all </span>field, specify whether all Pipeline and Sequential policies should synchronize between PV and T: this can be set to 0, 1, or a model variable. (If the value for <span style=" font-weight: bold;">Synchronize all</span> is 0, the individual settings in the Sync column are used. If <span style=" font-weight: bold;">Synchronize all</span> is turned on (1), then it is applied despite any individual settings of 0 in the Sync column.)</li></ol>
<a name="wp42406"></a>
<ol start="4."><li class="LL1Seq">Enter one or more policies, referring to the specifications for each of the types of timing policy below.</li></ol>
<a name="wp31982"></a>
<ol start="5."><li class="LL1Seq">You can choose to include/exclude a policy in a specific model generation by removing the checkmark to the left of the policy name in the table.</li></ol>
<a name="wp17849"></a><p class="pBody">
Note that:
</p>


<a name="wp17850"></a>
<ul><li class="LL1BulSolid">Expressions of literals, parameters, registers, and PV variables can be used in the Policies table. Only the relevant PV event types are listed (that is, all Master ports or all Slave ports).</li></ul>
<a name="wp17851"></a>
<ul><li class="LL1BulSolid">Specific transactions are entered in the format <span style=" font-weight: bold;">port_name.transaction_type </span>(for example, port3.READ); the port name alone refers to &ldquo;All Transactions on the port&rdquo;</li></ul>
<a name="wp58575"></a>
<ul><li class="LL1BulSolid">A Policy applies to all PV events of a specific type; for example, all READs or all WRITEs of a specific port.</li></ul><a name="MGCCIDPDelay Policy"></a>

<a name="wp58588"></a><h5 class="pHeading4">
  


Delay Policy
</h5>



<a name="wp31489"></a><p class="pBody">
A delay policy applies to a slave port, and represents &ldquo;response time&rdquo;, which is the time needed to process a block of data in a transaction at the port (all transaction types). For example, the time it takes (number of wait states) for a memory to acknowledge Read or Write data blocks. 
</p>


<a name="wp31491"></a>
<ul><li class="LL1BulSolid"><span style=" font-weight: bold;">Wait states</span>&#151;  clock cycles of the port</li></ul>
<a name="wp43369"></a>
<ul><li class="LL1BulSolid"><span style=" font-weight: bold;">Sync</span>&#151;  specifies that the response will come after the callback that is attached to the slave transaction finishes (that is, synchronization occurs at the end of the callback). If the callback finishes before the <span style=" font-weight: bold;">Wait states</span> parameter duration, the parameter is used.</li></ul>
<a name="wp60115"></a><p class="pBody">
The actual delay is calculated according to the following:
</p>


<a name="wp60116"></a><p class="pL1Body"><span style=" font-weight: bold;">latency + number_of_words * (number_of_wait_states + protocol clocks)</span></p>

<a name="wp60117"></a><p class="pBody">
Where `<span style=" font-weight: bold;">protocol clocks</span>', represented by `k' in <a href='javascript:oT("CRF","Chapter_Modeling_Phase31.html#wp58626");'>Figure&#160;7&#8209;20</a>, is the time used by the protocol itself.
</p>


<a name="wp60118"></a><p class="pBody">
For example: 
</p>


<a name="wp60119"></a><p class="pBody">
If a transaction has latency of 10 and passes 12 words with 2 wait states, then, given the fact that the protocol needs a clock for each word, the total delay (in the port clocks) will be:
</p>


<a name="wp60120"></a><p class="pL1Body">10 + 12 * (2 + 1) = 46</p>




<a name="wp58626"></a><p class="pFigureTitle">
Figure 7&#8209;20. 


Timing Policy: Delay


</p>
<div align="center"><img src="images/TimingPolocyDelay.gif" id="wp58624" border="0" hspace="0" vspace="0"/></div><p class="pFigureTitle">





</p>






<a name="wp58632"></a><p class="pFigureTitle">
Figure 7&#8209;21. 


Timing Policy: Delay + Sync


</p>
<div align="center"><img src="images/TimingPolicyDelayPlusSync.gif" id="wp58630" border="0" hspace="0" vspace="0"/></div><p class="pFigureTitle">





</p>



<a name="wp58642"></a><p class="pBody">
The power number that is specified for the policy defines the power it takes to communicate the data (in mW). It includes the power consumed by the bus adapter unit and the register file, if it exists. The time through which this power is consumed is the time calculated by the policy.
</p>


<a name="wp58644"></a><p class="pBody">
Whenever a new transaction starts on a port, the timing and power fields of the delay policy are evaluated; therefore, non-static expressions are supported. Moreover a callback defined in <span class="cReqRpl">model</span><span style=" font-weight: regular; font-style: italic;">_t.h</span> is called: 
</p>


<a name="wp58645"></a><pre class="pCode">     <span style=" font-family: Courier; font-weight: bold; font-angle: normal; vertical-align: baseline; color:#000000;">virtual void evaluate_delay_policy(mb::mb_delay_request&amp; request){}</span></pre>


<a name="wp58680"></a><pre class="pCode">     </pre>


<a name="wp58647"></a><p class="pBody">
To dynamically change the policy values, if needed, embed code in the function using the interface functions of <span style=" font-weight: bold;">mb::mb_delay_request </span>(which is defined in the file <span class="cReqRpl">vista_installation_directory</span><span style=" font-weight: regular; font-style: italic;">/papoulis/include/esl/sc_sim/mb_request.h</span>).
</p>


<a name="wp58690"></a><p class="pBody">
The following is an example of using the callback for setting the attributes on a condition:
</p>


<a name="wp58694"></a><pre class="pCode">     void ModelClassName_t::evaluate_delay_policy(mb::mb_delay_request&amp; request)</pre>


<a name="wp58714"></a><pre class="pCode">        {</pre>


<a name="wp58695"></a><pre class="pCode">        if (request.is_read) </pre>


<a name="wp58715"></a><pre class="pCodeIndent">
           {</pre>

<a name="wp58651"></a><pre class="pCodeIndent">
           request.setWaitStates(1);</pre>

<a name="wp58652"></a><pre class="pCodeIndent">
           request.setPowerInMw ( 0.02 );</pre>

<a name="wp58653"></a><pre class="pCodeIndent">
           } </pre>

<a name="wp58719"></a><pre class="pCode">        else </pre>


<a name="wp58723"></a><pre class="pCodeIndent">
           {</pre>

<a name="wp58654"></a><pre class="pCodeIndent">
           request.setWaitStates(2);</pre>

<a name="wp58655"></a><pre class="pCodeIndent">
           request.setPowerInMw ( 0.01 );</pre>

<a name="wp58656"></a><pre class="pCodeIndent">
           }</pre>

<a name="wp58657"></a><pre class="pCode">        }</pre>


<a name="wp58658"></a><pre class="pCode">     </pre>


<a name="wp58659"></a><p class="pBody">
The tcl command to add a delay policy is:
</p>


<a name="wp58660"></a><pre class="pCode">     <span style=" font-family: Courier; font-weight: bold; font-angle: normal; vertical-align: baseline; color:#000000;">add_delay_policy port_or_transaction wait_states -sync value <br />     -disabled value -latency value -power value</span></pre>


<a name="wp60132"></a><pre class="pCode">     </pre>


<br clear="all" />
<table border="0" cellpadding="0" cellspacing="0" width="80%" align="center">
  <tr valign="baseline">
    <td width="50" valign="top" background="wwhelp/wwhimpl/common/images/nbrule_upper.jpg">&#160;</td>
    <td background="wwhelp/wwhimpl/common/images/nbrule_upper.jpg"><span class="cNotesBlack">Note</span></td>
  </tr>
  <tr valign="top">
    <td width="50" valign="top"><img src="wwhelp/wwhimpl/common/images/nicon_note.jpg" /></td>
    <td valign="top">
            
<a name="wp141571"></a><p class="pnoteNote">
        	Delay policy is disabled for slave sockets of Signal pre-defined protocol. Such slave sockets do not show under the Delay policy Port/Transactions list.
        </p>

          </td>
  </tr>
  <tr height="2">
    <td height="2" background="wwhelp/wwhimpl/common/images/nbrule_bottom.jpg"><img src="wwhelp/wwhimpl/common/images/nbrule_bottom.jpg" align="left" /></td>
    <td height="2" background="wwhelp/wwhimpl/common/images/nbrule_bottom.jpg"><img src="wwhelp/wwhimpl/common/images/nbrule_bottom.jpg" align="right" /></td>
    </tr>
 </table><a name="MGCCIDPSplit Policy"></a>

<a name="wp58637"></a><h5 class="pHeading4">
  


Split Policy
</h5>



<a name="wp17862"></a><p class="pBody">
This policy applies to a master port and combines several parameters regarding splitting transactions. The splitting method also depends on the BUS and/or Protocol.
</p>


<a name="wp17863"></a>
<ul><li class="LL1BulSolid"><span style=" font-weight: bold;">Burst Size</span>: the size of the buffer by which data is transmitted to/from the port. The PV transaction is split into bursts of a size equal to the <span style=" font-weight: bold;">burst_size</span>. If <span style=" font-weight: bold;">burst_size</span> does not divide the size of the PV transaction, the last burst will have a size smaller than <span style=" font-weight: bold;">burst_size</span>.</li></ul>
<a name="wp19697"></a>
<ul><li class="LL1BulSolid"><span class="cP12"><span style=" font-weight: bold; font-angle: normal; vertical-align: baseline; color:#000000;">Latency:</span></span><span class="cP12"><span style=" font-weight: regular; font-angle: normal; vertical-align: baseline; color:#000000;"> the minimum time interval between each of the bursts that the PV transaction is split into. Utilization of the port falls below 100% in a typical case (that is, where Latency is a positive number). </span></span></li></ul>
<a name="wp91284"></a><p class="pL1Body">However, multiple PV transactions can be interleaved on one port. For example, when a DMA reads and writes on the same port, the port utilization could be 100% while the latency between read bursts will be more than the latency specified in the policy.</p>

<a name="wp141603"></a><p class="pBody">
The power number that is specified for the policy defines the power it takes to communicate the data (in mW). It includes the power consumed by the bus adapter unit. The time through which this power is consumed, which begins from the time the transaction starts, is computed as a bus clock cycle per word and is calculated by the following formula:
</p>


<a name="wp141604"></a><p class="pL1Body"><span style=" font-weight: bold;">number_of_words * port_clock</span> </p>

<a name="wp141605"></a><p class="pBody">
Whenever a new burst starts on the port, the timing and power fields of the split policy are evaluated; therefore, non-static expressions are supported. Moreover a callback defined in <span class="cReqRpl">model</span><span style=" font-weight: regular; font-style: italic;">_t.h</span> is called: 
</p>


<a name="wp141606"></a><pre class="pCode">     <span style=" font-family: Courier; font-weight: bold; font-angle: normal; vertical-align: baseline; color:#000000;">virtual void evaluate_split_policy(mb::mb_split_request&amp; request);</span></pre>


<a name="wp141652"></a><pre class="pCode">     </pre>


<a name="wp141655"></a><p class="pBody">
To dynamically change the policy values, if needed, embed code in the function using the interface functions of <span style=" font-weight: bold;">mb::mb_split_request</span> (which is defined in the file <span class="cReqRpl">vista_installation_directory</span><span style=" font-weight: regular; font-style: italic;">/papoulis/include/esl/sc_sim/mb_request.h</span>).
</p>





<a name="wp17870"></a><p class="pFigureTitle">
Figure 7&#8209;22. 


Timing Policy: Split


</p>
<div align="center"><img src="images/TimingPolicySplit.gif" id="wp20614" border="0" hspace="0" vspace="0"/></div><p class="pFigureTitle">





</p>



<a name="wp58777"></a><p class="pBody">
The following is an example of using the callback for setting the attributes on a condition:
</p>


<a name="wp58778"></a><pre class="pCode">     void evaluate_split policy(mb::mb_split_request&amp; request)</pre>


<a name="wp58811"></a><pre class="pCode">        {</pre>


<a name="wp58779"></a><pre class="pCodeIndent">
           if (request.is_read) </pre>

<a name="wp58831"></a><pre class="pCodeIndent">
           {</pre>

<a name="wp58780"></a><pre class="pCodeIndent">
              request.setLatecy(1);</pre>

<a name="wp58781"></a><pre class="pCodeIndent">
              request.setPowerInMw ( 0.02 );</pre>

<a name="wp58782"></a><pre class="pCodeIndent">
           } </pre>

<a name="wp58835"></a><pre class="pCodeIndent">
           else</pre>

<a name="wp58836"></a><pre class="pCodeIndent">
           {</pre>

<a name="wp58783"></a><pre class="pCodeIndent">
              request.setLatecy (2);</pre>

<a name="wp58784"></a><pre class="pCodeIndent">
              request.setPowerInMw ( 0.01 );</pre>

<a name="wp58785"></a><pre class="pCodeIndent">
           }</pre>

<a name="wp58786"></a><pre class="pCode">        }</pre>


<a name="wp58863"></a><pre class="pCode">     </pre>


<a name="wp58788"></a><p class="pBody">
The tcl command to add a split policy is:
</p>


<a name="wp58789"></a><pre class="pCode">     <span style=" font-family: Courier; font-weight: bold; font-angle: normal; vertical-align: baseline; color:#000000;">add_split_policy port_or_transaction burst_size -disabled value -latency value -power value</span></pre>


<a name="wp141621"></a><pre class="pCode">     </pre>


<br clear="all" />
<table border="0" cellpadding="0" cellspacing="0" width="80%" align="center">
  <tr valign="baseline">
    <td width="50" valign="top" background="wwhelp/wwhimpl/common/images/nbrule_upper.jpg">&#160;</td>
    <td background="wwhelp/wwhimpl/common/images/nbrule_upper.jpg"><span class="cNotesBlack">Note</span></td>
  </tr>
  <tr valign="top">
    <td width="50" valign="top"><img src="wwhelp/wwhimpl/common/images/nicon_note.jpg" /></td>
    <td valign="top">
            
<a name="wp141622"></a><p class="pnoteNote">
        	Split policy is disabled for master sockets of Signal pre-defined protocol. Such master sockets do not show under the Split policy Port/Transaction list.
        </p>

          </td>
  </tr>
  <tr height="2">
    <td height="2" background="wwhelp/wwhimpl/common/images/nbrule_bottom.jpg"><img src="wwhelp/wwhimpl/common/images/nbrule_bottom.jpg" align="left" /></td>
    <td height="2" background="wwhelp/wwhimpl/common/images/nbrule_bottom.jpg"><img src="wwhelp/wwhimpl/common/images/nbrule_bottom.jpg" align="right" /></td>
    </tr>
 </table><a name="MGCCIDPSequential Policy"></a>

<a name="wp17899"></a><h5 class="pHeading4">
  


Sequential Policy
</h5>



<a name="wp17900"></a><p class="pBody">
In this type of policy, you can define Latency for a PV event (the effect) on a PV event (the Cause). PV events include the following: read/write transactions on master/slave ports and read/write operations on Vista variables/registers and PV variables. Latency is measured from the <span style=" font-weight: bold;">end</span> of the cause to the start of the effect. Different latencies can be defined for different causes. 
</p>


<a name="wp27887"></a>
<ul><li class="LL1BulSolid"><span class="cP12"><span style=" font-weight: bold; font-angle: normal; vertical-align: baseline; color:#000000;">Sync</span></span><span class="cP12"><span style=" font-weight: regular; font-angle: normal; vertical-align: baseline; color:#000000;">&#151; specifies that the effect call should wait until the time it is supposed to start according to the timing policies.</span></span></li></ul>
<a name="wp42267"></a>
<ul><li class="LL1BulSolid"><span style=" font-weight: bold;">Cause</span>&#151; specifies the cause that triggers the PV event.</li></ul>
<a name="wp27888"></a>
<ul><li class="LL1BulSolid"><span style=" font-weight: bold;">Latency</span>&#151;  the latency is computed as the number of internal clock cycles in the model)</li></ul>
<a name="wp34974"></a><p class="pBody">
There might be doubts as to whether all the possible HW time behaviors can be modeled as a relationship between ports (P1 and P2 - P2 could be equal to P1) timing: that is, whether at the end of a transaction on port P1 one can know the time to the start of a transaction on port P2. Even though it can be proven that this time can be computed (and the learning algorithm does so - see <a href='javascript:oT("CRF","Chapter_Modeling_Phase39.html");'>&quot;Extracting Power from HDL Models&quot;</a>), it might not be easy to do manually. Variables can be used as &#39;cause&#39; and &#39;effect&#39; of sequential policies in order to specify inner model delays that accumulate to delays between ports.
</p>





<a name="wp17906"></a><p class="pFigureTitle">
Figure 7&#8209;23. 


Timing Policy: Sequential


</p>
<div align="center"><img src="images/TimingPolicySequential.gif" id="wp17904" border="0" hspace="0" vspace="0"/></div><p class="pFigureTitle">





</p>



<a name="wp17907"></a><p class="pBody">
<span style=" font-weight: bold;">Example</span>: 
</p>


<a name="wp17908"></a>
<ul><li class="LL1BulSolid">If in the PV trace there is a WRITE on X, and then a READ on Y, then the latency between the end of X.WRITE and the start of Y.READ is determined by looking up the delay in the appropriate policy (in clocks).</li></ul>
<a name="wp58882"></a><p class="pBody">
The power number that is specified for the policy defines the power that is consumed from the end of the `cause' event to the start of the `effect' event (the latency parameter of the policy).
</p>


<a name="wp58884"></a><p class="pBody">
Whenever the &ldquo;cause&rdquo; transaction ends, the timing and power fields of the sequential policy are evaluated; therefore, non-static expressions are supported. Moreover a callback defined in <span class="cReqRpl">model</span><span style=" font-weight: regular; font-style: italic;">_t.h</span> is called: 
</p>


<a name="wp58885"></a><pre class="pCode">     <span style=" font-family: Courier; font-weight: bold; font-angle: normal; vertical-align: baseline; color:#000000;">virtual void evaluate_sequential_policy(mb::mb_request&amp; cause_request, mb::mb_effect_request&amp; effect_request)</span></pre>


<a name="wp58923"></a><pre class="pCode">     </pre>


<a name="wp58887"></a><p class="pBody">
To dynamically change the policy values, if needed, embed code in the function using the interface functions of <span style=" font-weight: bold;">mb::mb_request</span> and <span style=" font-weight: bold;">mb_effect_request</span> (which are defined in the file <span class="cReqRpl">vista_installation_directory</span><span style=" font-weight: regular; font-style: italic;">/papoulis/include/esl/sc_sim/mb_request.h</span>).
</p>


<a name="wp58888"></a><p class="pBody">
The following is an example of using the callback for setting the attributes on a condition:
</p>


<a name="wp58934"></a><pre class="pCode">     void evaluate_sequential_policy(mb::mb_request&amp; cause_request, mb::mb_effect_request&amp; effect_request)</pre>


<a name="wp58938"></a><pre class="pCode">     {</pre>


<a name="wp58935"></a><pre class="pCode">        if (cause_request.is_read)</pre>


<a name="wp58939"></a><pre class="pCodeIndent">
           {</pre>

<a name="wp58891"></a><pre class="pCodeIndent">
           effect_request.setLatecy(1);</pre>

<a name="wp58892"></a><pre class="pCodeIndent">
           effect_request.setPowerInMw ( 0.02 );</pre>

<a name="wp58893"></a><pre class="pCodeIndent">
           } </pre>

<a name="wp58959"></a><pre class="pCode">        else</pre>


<a name="wp58963"></a><pre class="pCodeIndent">
           {</pre>

<a name="wp58894"></a><pre class="pCodeIndent">
           effect_request.setLatecy (2);</pre>

<a name="wp58895"></a><pre class="pCodeIndent">
           effect_request.setPowerInMw ( 0.01 );</pre>

<a name="wp58896"></a><pre class="pCodeIndent">
           }</pre>

<a name="wp58897"></a><pre class="pCode">     }</pre>


<a name="wp58997"></a><pre class="pCode">     </pre>


<a name="wp58900"></a><p class="pBody">
The tcl command for adding a sequential policy is:
</p>


<a name="wp58901"></a><pre class="pCode">     <span style=" font-family: Courier; font-weight: bold; font-angle: normal; vertical-align: baseline; color:#000000;">add_sequential_policy effect cause -latency value -sync value -disabled <br />     -power value</span></pre>


<a name="wp59009"></a><pre class="pCode">     </pre>


<a name="wp58903"></a><p class="pBody">
where <span style=" font-weight: bold;">effect</span> and <span style=" font-weight: bold;">cause</span> could be:
</p>


<a name="wp58904"></a>
<ul><li class="LL1BulSolid">Read or Write transactions on a specific port.</li></ul>
<a name="wp58905"></a>
<ul><li class="LL1BulSolid">Read or Write operations on model builder variable/register.</li></ul><a name="MGCCIDPPipeline Policy"></a>

<a name="wp17911"></a><h5 class="pHeading4">
  


Pipeline Policy
</h5>



<a name="wp26133"></a><p class="pBody">
The Pipeline policy is defined to reflect hardware pipeline (see <a href='javascript:oT("CRF","Chapter_Modeling_Phase31.html#wp17927");'>Figure&#160;7&#8209;24</a>). A Pipeline policy is defined between transactions on two ports. The latency is measured from the <span style=" font-weight: bold;">start</span> of the cause transaction.
</p>


<a name="wp43146"></a>
<ul><li class="LL1BulSolid"><span class="cP12"><span style=" font-weight: bold; font-angle: normal; vertical-align: baseline; color:#000000;">Sync</span></span><span class="cP12"><span style=" font-weight: regular; font-angle: normal; vertical-align: baseline; color:#000000;">&#151; specifies that the effect call should wait until the time it is supposed to start according to the timing policies.</span></span></li></ul>
<a name="wp43147"></a>
<ul><li class="LL1BulSolid"><span class="cP12"><span style=" font-weight: bold; font-angle: normal; vertical-align: baseline; color:#000000;">Cause</span></span><span class="cP12"><span style=" font-weight: regular; font-angle: normal; vertical-align: baseline; color:#000000;">&#151; The &ldquo;source&rdquo; of data to be pipelined</span></span></li></ul>
<a name="wp30861"></a>
<ul><li class="LL1BulSolid"><span class="cP12"><span style=" font-weight: bold; font-angle: normal; vertical-align: baseline; color:#000000;">Latency</span></span><span class="cP12"><span style=" font-weight: regular; font-angle: normal; vertical-align: baseline; color:#000000;">&#151; The time it takes (number of internal clock cycles) the model to compute the first output.</span></span></li></ul>
<a name="wp17918"></a>
<ul><li class="LL1BulSolid"><span style=" font-weight: bold;">Buffer Size</span>&#151; Number of data bytes that an implicit buffer, between the input and the output, holds. This number can be zero to signify that no buffer exists.</li></ul>
<a name="wp91450"></a><p class="pBody">
When there is no implicit buffer, you can model overlapping transactions. If the latency of the policy is smaller than the latency of the cause transaction, the effect transaction will start before the cause transaction terminates; in principle, the effect and cause transactions can finish out of order. The Sequential policy does not exhibit such behavior. The same will happen for cause and effect transactions on the same port, if the protocol and the HW configuration support multiple outstanding transactions; otherwise, the port will serialize the transactions.
</p>


<a name="wp91613"></a><p class="pBody">
Be advised, you should be cautious when using the pipeline policies. There could be some scenarios where the results of the simulation run in AT will not be as expected from the sequential code; however, the same results will occur with the hardware that implements the pipelined behavior. The following example shows this.
</p>


<a name="wp91617"></a><p class="pBody">
If you run the following functional code:
</p>


<a name="wp91619"></a><pre class="pCode">     bool x_pv::slave_callback_read (mb_address_type address, <br />        unsigned char* data, unsigned size) {</pre>


<a name="wp91620"></a><pre class="pCode">           return master_read (address, data, size); </pre>


<a name="wp91621"></a><pre class="pCode">     }</pre>


<a name="wp91622"></a><pre class="pCode">     </pre>


<a name="wp91623"></a><p class="pBody">
with the attached policy that specifies that reads on the master port <span style=" font-weight: bold;">master</span> should start 2 clock cycles after the start of the read on the slave port <span style=" font-weight: bold;">slave</span>:
</p>


<a name="wp91625"></a><pre class="pCode">     <span style=" font-weight: bold;">add_pipeline_policy</span> master.read <span style=" font-weight: bold;">cause</span> slave.read <span style=" font-weight: bold;">-latency 2 -buffer_size 0</span></pre>


<a name="wp91626"></a><pre class="pCode">     </pre>


<a name="wp91629"></a><p class="pBody">
The results of an LT simulation run are always OK; the slave read returns the value that was read through the master port. For an AT simulation run however, if the slave read transaction finishes before the master read transaction, the behavioral results will be undefined. This is because the slave read value is returned before it is updated by the master read transaction.
</p>


<a name="wp91632"></a><p class="pBody">
To solve this issue, you should define a delay policy with sync on the slave port that will force the slave transaction to finish only after the master transaction finishes.
</p>


<a name="wp91634"></a><pre class="pCode">     add_delay_policy slave.read 0 -sync 1</pre>


<a name="wp91770"></a><pre class="pCode">     </pre>


<a name="wp91452"></a><p class="pBody">
When an implicit buffer exists, it must be between the input and output on master ports. The cause transaction type should be a read on a master port and the effect transaction type should be a write on a master port or an error will occur. The write transaction(s) are issued only when the read transaction(s) fill the buffer. The buffer causes the following happens:
</p>


<a name="wp59031"></a>
<ul><li class="LL1BulSolid">The buffer size splits the data going in and out; hence, in the simple case, split policies are not needed. The buffer size splits the cause transactions. The buffer size, multiplied by the ratio between the cause size and the effect size, splits the effect. If the bus burst rules require bursts whose size is less than these sizes, split policies have to be declared. Split policies are also needed when setting the communication power.</li></ul>
<a name="wp59039"></a>
<ul><li class="LL1BulSolid">If the data rate of the cause transaction is faster than the data rate of the effect transaction, the number of data words in the buffer could exceed the buffer size. In this case, backpressure is applied and no more cause transactions are issued until enough space is vacated in the buffer.</li></ul>
<a name="wp30880"></a><p class="pBody">
Interleaving of transactions on the same port could lead to more complex behavior and the latency value could be overridden by the fact that some protocols limit the capacity of the port to communicating only one word per clock cycle.
</p>





<a name="wp17927"></a><p class="pFigureTitle">
Figure 7&#8209;24. 


Timing Policy: Pipeline


</p>
<div align="center"><img src="images/TimingPolicyPipelineBuffering.gif" id="wp20688" border="0" hspace="0" vspace="0"/></div><p class="pFigureTitle">





</p>



<a name="wp60072"></a><p class="pBody">
The power number that is specified for the policy defines the power that is consumed for each data word of the cause transaction. This power is consumed from the time the word is transmitted in the cause transaction for the latency parameter time length of the policy. 
</p>


<a name="wp60073"></a><p class="pBody">
The following examples explain the power behavior: 
</p>


<a name="wp60074"></a>
<ol start="1."><li class="LL1Seq">The power number (P) is 0.02 mW, the latency (L) is 30 NS (3 clocks). A cause transaction of 100 words (S) is issued at time 1000 NS (S&gt;L). The cause transaction is split into single words that are transmitted at each clock cycle. The power graph of the policy starts rising in steps of P for 2 clocks until it stabilizes at the value 0.06 mW (L*P) and after 998 clocks (S-L+1) goes down in steps of P for 2 clocks. </li></ol>
<a name="wp60075"></a>
<ol start="2."><li class="LL1Seq">The power number (P) is 0.02 mW, the latency (L) is 300 NS (10 clocks). A cause transaction of 4 words (S) is issued at time 1000 NS (S&lt;L). The cause transaction is split into single words that are transmitted at each clock cycle. The power graph of the policy starts rising in steps of P for 3 clocks until it stabilizes at the value 0.08 mW (S*P) and after 7 clocks (L-S+1) goes down in steps of P for 3 clocks. </li></ol>
<a name="wp60076"></a>
<ol start="3."><li class="LL1Seq">Using the same parameters as in example 1 when the cause transaction is non-split, the assumption is that a word is transmitted each clock cycle. The power graph of the policy should be the same as the one in example 1. However, in order not to schedule too many power events, this structure is replaced by a rectangle of the same height 0.06 mW (L*P) and length 100 clocks (S) starting at time 1000 NS that consumes the same energy.</li></ol>
<a name="wp60077"></a>
<ol start="4."><li class="LL1Seq">Using the same parameters as in example 2 when the cause transaction is non-split, the power graph will be a rectangle of height 0.08 mW (N*P) and length 10 clocks (L) starting at time 1000 NS.</li></ol>
<a name="wp59061"></a><p class="pBody">
Whenever the &ldquo;cause&rdquo; transaction starts, the timing and power fields of the pipeline policy are evaluated; therefore, non-static expressions are supported. Moreover, a callback that is defined in <span class="cReqRpl">model</span><span style=" font-weight: regular; font-style: italic;">_t.h</span> is called: 
</p>


<a name="wp59062"></a><pre class="pCode">     <span style=" font-family: Courier; font-weight: bold; font-angle: normal; vertical-align: baseline; color:#000000;">virtual void evaluate_pipeline_policy(mb::mb_request&amp; cause_request, mb::mb_effect_request&amp; effect_request)</span></pre>


<a name="wp59097"></a><pre class="pCode">     </pre>


<a name="wp59064"></a><p class="pBody">
To dynamically change the policy values, if needed, embed code in the function using the interface functions of <span style=" font-weight: bold;">mb::mb_request</span> and <span style=" font-weight: bold;">mb_effect_request</span> (defined in the file <span class="cReqRpl">vista_installation_directory</span><span style=" font-weight: regular; font-style: italic;">/papoulis/include/esl/sc_sim/mb_request.h</span>).
</p>


<a name="wp59065"></a><p class="pBody">
The following is an example of using the callback for setting the attributes on a condition:
</p>


<a name="wp59066"></a><pre class="pCode">     void evaluate_pipeline_policy(mb::mb_request&amp; cause_request, mb::mb_effect_request&amp; effect_request)</pre>


<a name="wp59107"></a><pre class="pCode">        {</pre>


<a name="wp59067"></a><pre class="pCodeIndent">
           if (cause_request.is_read)</pre>

<a name="wp59111"></a><pre class="pCodeIndent">
              {</pre>

<a name="wp59068"></a><pre class="pCodeIndent">
                 effect_request.setLatecy(1);</pre>

<a name="wp59069"></a><pre class="pCodeIndent">
                 effect_request.setPowerInMw ( 0.02 );</pre>

<a name="wp59070"></a><pre class="pCodeIndent">
              } </pre>

<a name="wp59131"></a><pre class="pCodeIndent">
           else </pre>

<a name="wp59132"></a><pre class="pCodeIndent">
              {</pre>

<a name="wp59071"></a><pre class="pCodeIndent">
                 effect_request.setLatecy (2);</pre>

<a name="wp59072"></a><pre class="pCodeIndent">
                 effect_request.setPowerInMw ( 0.01 );</pre>

<a name="wp59073"></a><pre class="pCodeIndent">
              }</pre>

<a name="wp59074"></a><pre class="pCode">        }</pre>


<a name="wp59106"></a><pre class="pCode">     </pre>


<a name="wp59077"></a><p class="pBody">
The tcl command for adding a sequential policy is:
</p>


<a name="wp59078"></a><pre class="pCode">     <span style=" font-family: Courier; font-weight: bold; font-angle: normal; vertical-align: baseline; color:#000000;">add_pipeline_policy effect cause -latency value -buffer_size value <br />     -sync value -disabled -power value</span></pre>


<a name="wp59167"></a><pre class="pCode">     </pre>


<a name="wp59080"></a><p class="pBody">
Where <span style=" font-weight: bold;">effect</span> and <span style=" font-weight: bold;">cause</span> could be:
</p>


<a name="wp59081"></a>
<ul><li class="LL1BulSolid">Read or Write transactions on a specific port.</li></ul><a name="MGCCIDPState Based Power Policy"></a>

<a name="wp53967"></a><h5 class="pHeading4">
  


State Based Power Policy
</h5>



<a name="wp53971"></a><p class="pBody">
A State Based Power policy is defined for registers and MB variables. Each time one of the objects is written, the policy is evaluated and the power to be consumed is returned until the next `write'.
</p>


<a name="wp54075"></a><p class="pBody">
The thing that is notable for this representation is the fact that it always consumes power; the model consumes power even when it does nothing (when no callbacks or threads are running). During this idle state, in real life, a component only consumes clock tree and leakage power.
</p>


<a name="wp59189"></a><p class="pBody">
Thus, State based power should be used when there are actions that aren't modeled explicitly:
</p>


<a name="wp59199"></a>
<ul><li class="LL1BulSolid">In the initial stages, it can be used for rough estimations.</li></ul>
<a name="wp59208"></a>
<ul><li class="LL1BulSolid">When there are threads which are inconvenient to model or that they slow the simulation speed unnecessarily. An example of such threads is a component that periodically checks on an Antenna; the frequency of the checks may depend on the component's model. The model of the component can include a callback on the Antenna's input without modeling the checking mechanism.</li></ul>
<a name="wp55084"></a><p class="pBody">
Defining the state based power policy is shown in <a href='javascript:oT("CRF","Chapter_Modeling_Phase31.html#wp54937");'>Table&#160;7&#8209;9</a> and the description that follows.
</p>
<div id="TableDivQz"></div>
<div align="center">


<a name="wp54937"></a><p class="pTableTitle">
Table 7&#8209;9. 


Defining State Based Power Policy
</p>



<table border="1" cellpadding="5" cellspacing="0" id="wp54937table54935">
  <tr bgcolor="#CCCCCC"  align="center" valign="middle">
    <th>

<a name="wp54947"></a><p class="pTableHeading">
State Variable
</p>
</th>

    <th>

<a name="wp54949"></a><p class="pTableHeading">
State Variable
</p>


</th>

    <th>

<a name="wp54951"></a><p class="pTableHeading">
...
</p>


</th>

    <th>

<a name="wp54953"></a><p class="pTableHeading">
State Variable
</p>


</th>

    <th>

<a name="wp54955"></a><p class="pTableHeading">
Power (mW)
</p>


</th>


</tr>

  <tr align="left" valign="top">
    <td>


<a name="wp54957"></a><p class="pTableCell">
v_1

</p>

</td>

    <td>


<a name="wp54959"></a><p class="pTableCell">
v_2

</p>

</td>

    <td>


<a name="wp54961"></a><p class="pTableCell">
...

</p>

</td>

    <td>


<a name="wp54963"></a><p class="pTableCell">
v_n

</p>

</td>

    <td>

&#160;</td>


</tr>

  <tr align="left" valign="top">
    <td>


<a name="wp54967"></a><p class="pTableCell">
a_11

</p>

</td>

    <td>


<a name="wp54969"></a><p class="pTableCell">
a_12

</p>

</td>

    <td>


<a name="wp54971"></a><p class="pTableCell">
...

</p>

</td>

    <td>


<a name="wp54973"></a><p class="pTableCell">
a_1n

</p>

</td>

    <td>


<a name="wp54975"></a><p class="pTableCell">
p_1

</p>

</td>


</tr>

  <tr align="left" valign="top">
    <td>


<a name="wp54977"></a><p class="pTableCell">
a_21

</p>

</td>

    <td>


<a name="wp54979"></a><p class="pTableCell">
a_22

</p>

</td>

    <td>


<a name="wp54981"></a><p class="pTableCell">
...

</p>

</td>

    <td>


<a name="wp54983"></a><p class="pTableCell">
a_2n

</p>

</td>

    <td>


<a name="wp54985"></a><p class="pTableCell">
p_2

</p>

</td>


</tr>

  <tr align="left" valign="top">
    <td>


<a name="wp54987"></a><p class="pTableCell">
...

</p>

</td>

    <td>


<a name="wp54989"></a><p class="pTableCell">
...

</p>

</td>

    <td>


<a name="wp54991"></a><p class="pTableCell">
...

</p>

</td>

    <td>


<a name="wp54993"></a><p class="pTableCell">
...

</p>

</td>

    <td>


<a name="wp54995"></a><p class="pTableCell">
...

</p>

</td>


</tr>

  <tr align="left" valign="top">
    <td>


<a name="wp54997"></a><p class="pTableCell">
a_m1

</p>

</td>

    <td>


<a name="wp54999"></a><p class="pTableCell">
a_m2

</p>

</td>

    <td>


<a name="wp55001"></a><p class="pTableCell">
...

</p>

</td>

    <td>


<a name="wp55003"></a><p class="pTableCell">
a_mn

</p>

</td>

    <td>


<a name="wp55005"></a><p class="pTableCell">
p_m

</p>

</td>


</tr>


</table>

</div>
<div id='EndTable'> </div>
<p class="pBody">
<br clear='left' class='Blank4Table' />


</p>


<a name="wp55096"></a><p class="pBody">
Whenever one of the variables v_1, v_2, ..., v_n is written the values in the table are evaluated and the corresponding power value is consumed till the next write to one of the above variables.
</p>


<a name="wp55098"></a><p class="pBody">
The calculations are carried out as follows:
</p>


<a name="wp55100"></a><pre class="pCode">     <span style=" font-family: Courier; font-weight: bold; font-angle: normal; vertical-align: baseline; color:#000000;">if (v_1 == a_11 &amp;&amp; v_2 == a_12 &amp;&amp; ... v_n == a_1n)</span></pre>


<a name="wp55101"></a><pre class="pCode">     <span style=" font-family: Courier; font-weight: bold; font-angle: normal; vertical-align: baseline; color:#000000;">   power = p_1;</span></pre>


<a name="wp55102"></a><pre class="pCode">     <span style=" font-family: Courier; font-weight: bold; font-angle: normal; vertical-align: baseline; color:#000000;">else</span></pre>


<a name="wp55103"></a><pre class="pCode">     <span style=" font-family: Courier; font-weight: bold; font-angle: normal; vertical-align: baseline; color:#000000;">if (v_1 == a_21 &amp;&amp; v_2 == a_22 &amp;&amp; ... v_n == a_2n)</span></pre>


<a name="wp55104"></a><pre class="pCode">     <span style=" font-family: Courier; font-weight: bold; font-angle: normal; vertical-align: baseline; color:#000000;">   power = p_2;</span></pre>


<a name="wp55105"></a><pre class="pCode">     <span style=" font-family: Courier; font-weight: bold; font-angle: normal; vertical-align: baseline; color:#000000;">else</span></pre>


<a name="wp55106"></a><pre class="pCode">     <span style=" font-family: Courier; font-weight: bold; font-angle: normal; vertical-align: baseline; color:#000000;">        ...</span></pre>


<a name="wp55107"></a><pre class="pCode">     <span style=" font-family: Courier; font-weight: bold; font-angle: normal; vertical-align: baseline; color:#000000;">else</span></pre>


<a name="wp55108"></a><pre class="pCode">     <span style=" font-family: Courier; font-weight: bold; font-angle: normal; vertical-align: baseline; color:#000000;">if (v_1 == a_m1 &amp;&amp; v_2 == a_m2 &amp;&amp; ... v_n == a_mn)</span></pre>


<a name="wp55109"></a><pre class="pCode">     <span style=" font-family: Courier; font-weight: bold; font-angle: normal; vertical-align: baseline; color:#000000;">   power = p_m;</span></pre>


<a name="wp55110"></a><pre class="pCode">     <span style=" font-family: Courier; font-weight: bold; font-angle: normal; vertical-align: baseline; color:#000000;">else</span></pre>


<a name="wp55111"></a><pre class="pCode">     <span style=" font-family: Courier; font-weight: bold; font-angle: normal; vertical-align: baseline; color:#000000;">   power = 0;</span></pre>


<a name="wp59243"></a><pre class="pCode">     </pre>


<br clear="all" />
<table border="0" cellpadding="0" cellspacing="0" width="80%" align="center">
  <tr valign="baseline">
    <td width="50" valign="top" background="wwhelp/wwhimpl/common/images/nbrule_upper.jpg">&#160;</td>
    <td background="wwhelp/wwhimpl/common/images/nbrule_upper.jpg"><span class="cNotesBlack">Note</span></td>
  </tr>
  <tr valign="top">
    <td width="50" valign="top"><img src="wwhelp/wwhimpl/common/images/nicon_note.jpg" /></td>
    <td valign="top">
            
<a name="wp59251"></a><p class="pnoteNote">
        	The state variable value a_ij could be an empty string. In this case the v_i == a_ij condition is always evaluated to true.
        </p>

          </td>
  </tr>
  <tr height="2">
    <td height="2" background="wwhelp/wwhimpl/common/images/nbrule_bottom.jpg"><img src="wwhelp/wwhimpl/common/images/nbrule_bottom.jpg" align="left" /></td>
    <td height="2" background="wwhelp/wwhimpl/common/images/nbrule_bottom.jpg"><img src="wwhelp/wwhimpl/common/images/nbrule_bottom.jpg" align="right" /></td>
    </tr>
 </table>
<a name="wp59256"></a><p class="pBody">
Whenever one of the above variables is written, the power field of the state power policy is evaluated thus non static expressions are supported. Moreover, a callback which is defined in <span class="cReqRpl">model</span><span style=" font-weight: regular; font-style: italic;">_t.h</span> is called: 
</p>


<a name="wp59257"></a><pre class="pCode">     <span style=" font-family: Courier; font-weight: bold; font-angle: normal; vertical-align: baseline; color:#000000;">virtual void evaluate_state_power_policy(mb::mb_effect_request&amp; request)</span></pre>


<a name="wp59284"></a><pre class="pCode">     </pre>


<a name="wp59259"></a><p class="pBody">
To dynamically change the policy value, if needed, embed code in the function using the interface functions of the <span style=" font-weight: bold;">mb_effect_request</span> (defined in the file <span class="cReqRpl">vista_installation_directory</span><span style=" font-weight: regular; font-style: italic;">/papoulis/include/esl/sc_sim/mb_request.h</span>.
</p>


<a name="wp59261"></a><p class="pBody">
The following is an example of using the callback for setting the attributes upon a condition:
</p>


<a name="wp59306"></a><pre class="pCode">     void evaluate_state_power_policy(mb::mb_effect_request&amp; request)</pre>


<a name="wp59313"></a><pre class="pCode">     {</pre>


<a name="wp59308"></a><pre class="pCodeIndent">
           if (strcmp(request.getVariableOrRegisterName(), &ldquo;reg1&rdquo;) &amp;&amp; </pre>

<a name="wp59299"></a><pre class="pCodeIndent">
             // getVariableOrRegisterName()returns which variable or register was written</pre>

<a name="wp59326"></a><pre class="pCodeIndent">
           getMachineArch()-&gt;reg1 &lt; getMachineArch()-&gt;reg2) </pre>

<a name="wp59327"></a><pre class="pCodeIndent">
           {</pre>

<a name="wp59266"></a><pre class="pCodeIndent">
                 request.setPowerInMw ( 0.02 );</pre>

<a name="wp59267"></a><pre class="pCodeIndent">
           } </pre>

<a name="wp59335"></a><pre class="pCodeIndent">
           else </pre>

<a name="wp59336"></a><pre class="pCodeIndent">
           {</pre>

<a name="wp59268"></a><pre class="pCodeIndent">
                 request.setPowerInMw ( 0.01 );</pre>

<a name="wp59269"></a><pre class="pCodeIndent">
           }</pre>

<a name="wp59270"></a><pre class="pCode">     }</pre>


<a name="wp59346"></a><pre class="pCode">     </pre>


<a name="wp55141"></a><p class="pBody">
The tcl command to define the i-th state power line in the above table is:
</p>


<a name="wp55094"></a><pre class="pCode">     <span style=" font-family: Courier; font-weight: bold; font-angle: normal; vertical-align: baseline; color:#000000;">state_power p_i -condition_pairs {v1 a_i1 v2 a_i1 ... v_n a_in} -disabled</span></pre>


<a name="wp137892"></a><pre class="pCode">     </pre>

<a name="MGCCIDPGenerating Power Model Code"></a>

<a name="wp137901"></a><h6 class="pHeading5">
  


Generating Power Model Code
</h6>



<a name="wp138151"></a><p class="pBody">
Use the following command to create a power model based on a state power policy defined in a TLM module.
</p>


<a name="wp138187"></a><p class="pzUsage">
	generate_power_model_code <span class="cReqRpl">tlm_model_path</span> [<span class="cOptRpl">output_directory</span>]
</p>


<a name="wp138149"></a><p class="pBody">
The model contains all the variables involved in the state power policy. You must instantiate the model in your SystemC module. For a detailed description of the command arguments see &ldquo;<a href='javascript:oT("CRF","Chapter_Command_Line_Ops_mb19.html");'>generate_power_model_code</a>&rdquo;.
</p>


<a name="wp137950"></a><p class="pBody">
The following example shows how to use the generated power model. 
</p>


<a name="wp137905"></a><pre class="pCode">     // constructor of the SystemC RTL  memory model</pre>


<a name="wp137906"></a><pre class="pCode">     &#0133;</pre>


<a name="wp137907"></a><pre class="pCode">     // instantiate the generated memory power model </pre>


<a name="wp137908"></a><pre class="pCode">     power_model_instance = new memory_power_model(&quot;memory&quot;);</pre>


<a name="wp137909"></a><pre class="pCode">     &#0133;</pre>


<a name="wp137910"></a><pre class="pCode">     // some event occurs</pre>


<a name="wp137911"></a><pre class="pCode">     power_model_instance-&gt;var_1 = val_1;</pre>


<a name="wp137912"></a><pre class="pCode">     </pre>


<a name="wp137913"></a><p class="pBody">
In the example code, when var_1 is assigned, the evaluate function of the power model is called and the appropriate power is computed. For simulation of a power model outside of Vista, a callback named user_evaluate is called; the callback uses the computed power value as an argument.
</p>

<a name="MGCCIDPSpecifying Power Policies"></a>

<a name="wp137897"></a><h5 class="pHeading4">
  


Specifying Power Policies
</h5>



<a name="wp54108"></a><p class="pBody">
To specify power policies, do the following:
</p>


<br clear="all" />
<table border="0" cellpadding="0" cellspacing="0" width="80%" align="center">
  <tr valign="baseline">
    <td width="50" valign="top" background="wwhelp/wwhimpl/common/images/nbrule_upper.jpg">&#160;</td>
    <td background="wwhelp/wwhimpl/common/images/nbrule_upper.jpg"><span class="cNotesBlack">Note</span></td>
  </tr>
  <tr valign="top">
    <td width="50" valign="top"><img src="wwhelp/wwhimpl/common/images/nicon_note.jpg" /></td>
    <td valign="top">
            
<a name="wp54086"></a><p class="pnoteNote">
        <span style=" font-weight: regular; font-angle: normal;">	All power values are in mW per specified nominal clock</span><span style=" font-weight: bold;"> (</span><span style=" font-weight: regular; font-angle: normal;">default of 100 MHz</span><span style=" font-weight: bold;">)</span><span style=" font-weight: regular; font-angle: normal;">.<br />&#160;</span>
        </p>

          </td>
  </tr>
  <tr height="2">
    <td height="2" background="wwhelp/wwhimpl/common/images/nbrule_bottom.jpg"><img src="wwhelp/wwhimpl/common/images/nbrule_bottom.jpg" align="left" /></td>
    <td height="2" background="wwhelp/wwhimpl/common/images/nbrule_bottom.jpg"><img src="wwhelp/wwhimpl/common/images/nbrule_bottom.jpg" align="right" /></td>
    </tr>
 </table>
<a name="wp17996"></a>
<ol start="1."><li class="LL1Seq">Select the model for which you want to define power policies.</li></ol>
<a name="wp17997"></a>
<ol start="2."><li class="LL1Seq">In Vista's modeling dialog, select the <span style=" font-weight: bold;">T</span> tab; then select the <span style=" font-weight: bold;">Timing &amp; Power </span>tab.</li></ol>
<a name="wp29884"></a>
<ol start="3."><li class="LL1Seq">Depending on the power type, do the following:</li></ol>
<a name="wp54119"></a><ul><li class="LL2BulSolid">For Communication Power, specify delay and/or split policies and enter the power value in the <span style=" font-weight: bold;">power</span> column.</li></ul>
<a name="wp54123"></a><ul><li class="LL2BulSolid">For Computation (Operation) Power, specify sequential and/or pipeline policies and enter the power value in the <span style=" font-weight: bold;">power</span> column.</li></ul>
<a name="wp54124"></a><ul><li class="LL2BulSolid">For State Based Power, use the `state power policies' table as follows:</li></ul>
<a name="wp54128"></a><ol start="1."><li class="LL3Seq">Add one or more state variables or registers whose state value affects power, by choosing the <span style=" font-weight: bold;">Insert Column</span> from the RMB menu, or by clicking on the label of the `...' column and typing an item or selecting one from the pulldown list.</li></ol>
<a name="wp54134"></a><ol start="2."><li class="LL3Seq">In the table, fill the variables' values and the power. Empty variables' values with an indicated power value define the default power.</li></ol>
<br clear="all" />
<table border="0" cellpadding="0" cellspacing="0" width="80%" align="center">
  <tr valign="baseline">
    <td width="50" valign="top" background="wwhelp/wwhimpl/common/images/nbrule_upper.jpg">&#160;</td>
    <td background="wwhelp/wwhimpl/common/images/nbrule_upper.jpg"><span class="cNotesBlack">Note</span></td>
  </tr>
  <tr valign="top">
    <td width="50" valign="top"><img src="wwhelp/wwhimpl/common/images/nicon_note.jpg" /></td>
    <td valign="top">
            
<a name="wp54135"></a><p class="pnoteNote">
        	This table is translated to `if-else' statements, so the order in the table is extremely important.
        </p>

          </td>
  </tr>
  <tr height="2">
    <td height="2" background="wwhelp/wwhimpl/common/images/nbrule_bottom.jpg"><img src="wwhelp/wwhimpl/common/images/nbrule_bottom.jpg" align="left" /></td>
    <td height="2" background="wwhelp/wwhimpl/common/images/nbrule_bottom.jpg"><img src="wwhelp/wwhimpl/common/images/nbrule_bottom.jpg" align="right" /></td>
    </tr>
 </table>
<br clear="all" />
<table border="0" cellpadding="0" cellspacing="0" width="80%" align="center">
  <tr valign="baseline">
    <td width="50" valign="top" background="wwhelp/wwhimpl/common/images/nbrule_upper.jpg">&#160;</td>
    <td background="wwhelp/wwhimpl/common/images/nbrule_upper.jpg"><span class="cNotesBlack">Note</span></td>
  </tr>
  <tr valign="top">
    <td width="50" valign="top"><img src="wwhelp/wwhimpl/common/images/nicon_note.jpg" /></td>
    <td valign="top">
            
<a name="wp54170"></a><p class="pnoteNote">
        


<img src="images/Chapter_Modeling_Phase49a.jpg" height="36" width="35" id="wp54173" border="0" hspace="0" vspace="0"/>



	You can remove the `<span style=" font-weight: bold;">state variable</span>' column by right clicking the column name and choosing <span style=" font-weight: bold;">Delete Selected Column</span> from the popup menu or using the <span style=" font-weight: bold;">Delete</span> key on the keyboard.
        </p>

          </td>
  </tr>
  <tr height="2">
    <td height="2" background="wwhelp/wwhimpl/common/images/nbrule_bottom.jpg"><img src="wwhelp/wwhimpl/common/images/nbrule_bottom.jpg" align="left" /></td>
    <td height="2" background="wwhelp/wwhimpl/common/images/nbrule_bottom.jpg"><img src="wwhelp/wwhimpl/common/images/nbrule_bottom.jpg" align="right" /></td>
    </tr>
 </table>
<a name="wp29885"></a>
<ol start="4."><li class="LL1Seq">Specify the <span style=" font-weight: bold;">Clock Tree</span> in mW. This is the average energy spent per clock cycle.</li></ol>
<a name="wp29892"></a>
<ol start="5."><li class="LL1Seq">For static power, specify the <span style=" font-weight: bold;">Leakage</span> parameters (in mW).</li></ol>
<br clear="all" />
<table border="0" cellpadding="0" cellspacing="0" width="80%" align="center">
  <tr valign="baseline">
    <td width="50" valign="top" background="wwhelp/wwhimpl/common/images/nbrule_upper.jpg">&#160;</td>
    <td background="wwhelp/wwhimpl/common/images/nbrule_upper.jpg"><span class="cNotesBlack">Note</span></td>
  </tr>
  <tr valign="top">
    <td width="50" valign="top"><img src="wwhelp/wwhimpl/common/images/nicon_note.jpg" /></td>
    <td valign="top">
            
<a name="wp55338"></a><p class="pnoteNote">
        	The corresponding tcl commands for setting leakage and clock tree powers are <span style=" font-weight: bold;">`set_leakage_power power'</span> and `<span style=" font-weight: bold;">set_clock_tree_power power'</span> respectively.
        </p>

          </td>
  </tr>
  <tr height="2">
    <td height="2" background="wwhelp/wwhimpl/common/images/nbrule_bottom.jpg"><img src="wwhelp/wwhimpl/common/images/nbrule_bottom.jpg" align="left" /></td>
    <td height="2" background="wwhelp/wwhimpl/common/images/nbrule_bottom.jpg"><img src="wwhelp/wwhimpl/common/images/nbrule_bottom.jpg" align="right" /></td>
    </tr>
 </table>
<a name="wp61874"></a>
<ol start="6."><li class="LL1Seq">Specify the power per nominal clock in MHz in the <span style=" font-weight: bold;">Power per nominal clock</span> field. The default is 100 MHz for a clock of 10 ns.</li></ol>



<a name="wp61880"></a><p class="pFigureTitle">
Figure 7&#8209;25. 


T tab - Timing &amp; Power - State Power Policies


</p>
<div align="center"><img src="images/model_power.gif" id="wp61885" border="0" hspace="0" vspace="0"/></div><p class="pFigureTitle">





</p>



<a name="wp61881"></a><h6 class="pHTaskSubhead">
  Remarks
</h6>



<a name="wp55386"></a>
<ul><li class="LL1BulSolid">If the model uses clocks other than the nominal clock, the power values will be recalculated as:</li></ul>
<a name="wp55395"></a><p class="pL1Body"><span style=" font-weight: bold;">power_value * nominal_clock / actual_clock</span></p>

<a name="wp55411"></a><p class="pL1Body">For example, if in some delay policy a value of 1 mW was defined in the &ldquo;Power&rdquo; field and the port clock is 1 ns, nominal clock is 10 ns (100 MHz) then the new power value per word will be:</p>

<a name="wp55376"></a><p class="pL1Body"><span style=" font-weight: bold;">1 * (10 ns) / (1 ns) = 10 mW</span></p>

<br clear="all" />
<table border="0" cellpadding="0" cellspacing="0" width="80%" align="center">
  <tr valign="baseline">
    <td width="50" valign="top" background="wwhelp/wwhimpl/common/images/nbrule_upper.jpg">&#160;</td>
    <td background="wwhelp/wwhimpl/common/images/nbrule_upper.jpg"><span class="cNotesBlack">Note</span></td>
  </tr>
  <tr valign="top">
    <td width="50" valign="top"><img src="wwhelp/wwhimpl/common/images/nicon_note.jpg" /></td>
    <td valign="top">
            
<a name="wp55377"></a><p class="pnoteNote">
        	The above correction will be applied to all the power values, except the leakage power.<br />&#160;
        </p>

          </td>
  </tr>
  <tr height="2">
    <td height="2" background="wwhelp/wwhimpl/common/images/nbrule_bottom.jpg"><img src="wwhelp/wwhimpl/common/images/nbrule_bottom.jpg" align="left" /></td>
    <td height="2" background="wwhelp/wwhimpl/common/images/nbrule_bottom.jpg"><img src="wwhelp/wwhimpl/common/images/nbrule_bottom.jpg" align="right" /></td>
    </tr>
 </table>
<a name="wp55378"></a>
<ul><li class="LL1BulSolid">The corresponding tcl command for setting the nominal clock is:</li></ul>
<a name="wp55379"></a><pre class="pCodeIndent">
           <span style=" font-family: Courier; font-weight: bold; font-angle: normal; vertical-align: baseline; color:#000000;">set_nominal_clock frequency_value</span></pre>

<a name="wp55444"></a><pre class="pCodeIndent">
           </pre>

<a name="wp55380"></a><p class="pL1Body">where `frequency_value' is in MHz.</p>

<a name="wp55450"></a>
<ul><li class="LL1BulSolid">In every model a default parameter called nominal_voltage is defined (in volts). </li></ul>
<a name="wp59610"></a>
<ul><li class="LL1BulSolid">From <span class="cReqRpl">model</span>_pv and <span class="cReqRpl">model</span>_t classes you can call the following interface function in order to set a new voltage:</li></ul>
<a name="wp59611"></a><pre class="pCodeIndent">
           void set_voltage(config::real80 voltage);</pre>

<a name="wp59612"></a><pre class="pCodeIndent">
           </pre>

<a name="wp59613"></a><p class="pL1Body">The following is an example of the use of such a call:</p>

<a name="wp59614"></a><pre class="pCodeIndent">
           void cb_write_dvfs (unsigned int newValue)</pre>

<a name="wp59636"></a><pre class="pCodeIndent">
           {</pre>

<a name="wp59647"></a><pre class="pCodeIndent">
             set_internal_clock(newValue);</pre>

<a name="wp59654"></a><pre class="pCodeIndent">
             double new_voltage=compute_voltage_from_clock(newValue);</pre>

<a name="wp59655"></a><pre class="pCodeIndent">
              // the function compute_voltage_from_clock is defined by the user</pre>

<a name="wp59619"></a><pre class="pCodeIndent">
             set_voltage((double)newValue);</pre>

<a name="wp59620"></a><pre class="pCodeIndent">
             // Modeling an internal power controller that changes the clock frequency and voltage upon SW command</pre>

<a name="wp59621"></a><pre class="pCodeIndent">
           }</pre>

<a name="wp59667"></a><pre class="pCodeIndent">
           </pre>

<a name="wp55458"></a>
<ul><li class="LL1BulSolid">After setting a new current voltage, all the model power values will be recalculated as follows:</li></ul>
<a name="wp55460"></a><pre class="pCodeIndent">
           <span style=" font-family: Courier; font-weight: bold; font-angle: normal; vertical-align: baseline; color:#000000;">power_value * (current_voltage / nominal_voltage)^2</span></pre>

<a name="wp55521"></a><pre class="pCodeIndent">
           </pre>

<a name="wp55462"></a><p class="pL1Body">For example, if the nominal_voltage is 1V and the current voltage is set to 0.9V then the new power value will be:</p>

<a name="wp55448"></a><pre class="pCodeIndent">
           <span style=" font-family: Courier; font-weight: bold; font-angle: normal; vertical-align: baseline; color:#000000;">power_value * (0.9^2) = power_value * 0.81</span></pre>




<script type="text/javascript" language="JavaScript1.2">
<!--
   PageTitle = "Timing and Power Policies";
   PDFLinkTitle = "Timing.and.Power.Policies"
   ThisTopic = "FIGURETtabTimingPowerStatePowerPolicies";
   CurrentFile = "Chapter_Modeling_Phase31.html";
   MGCSetDocumentVariables();
   MGCUpdateNavPane();
      MGCInsertRTFooter();
 // -->
 </script>



  </body>
</html>
