<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
    <meta name="GENERATOR" content="Quadralay WebWorks AutoMap 2003 for FrameMaker 8.0.2.1385" />
    <meta name="TEMPLATEBASE" content="mgc_ww_v2.1.078" />
    <meta name="LASTUPDATED" content="Tue Nov 27 10:08:20 2012" />
    <meta name="mgc_html_doctitle" content="Vista User's Manual" />
    <title>4 - Definition of the State Machine</title>
<!-- Search Engine keywords -->
    <meta name="attributes" content=" doc.type.documentation.user,doc.type.documentation.ref,product.version.v3.5,product.name.vista"/>
<!-- JavaScript Files -->
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/context.js"></script>
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/js/file_list.js"></script>
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/js/breadcrumbs.js"></script>
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/js/docvars.js"></script>
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/towwhdir.js"></script>
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/wwhpagef.js"></script>
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/topics.js"></script>
    <script type="text/javascript" language="JavaScript1.2" src="wwhelp/wwhimpl/common/scripts/popup_window.js"></script>
    <script type="text/javascript" language="JavaScript1.2" src="scripts/expand.js"></script>
    <script type="text/javascript" language="JavaScript1.2">
    <!--
      // Set reference to top level help frame
      //
      if (( window.name != "SearchTopic") && ( window.name != "PopupTopic"))
      {   var  WWHFrame = WWHGetWWHFrame(  ""); }
      else
      { var WWHFrame = eval("parent.parent"); }
      // -->
    </script>
    <script type="text/javascript" language="JavaScript1.2">
    <!--
    var  WWHFrame = eval("parent.parent");
	document.write(MGCGetInternalStyleSheet(1));
	document.write(MGCGetDocumentStyleSheet(0));
	document.write(MGCGetPGFStyleSheet(0));
    // -->
    </script>
  </head>


<body class="body" rightmargin="25" onLoad="WWHUpdate();" onUnload="WWHUnload();" onKeyDown="WWHHandleKeyDown((document.all||document.getElementById||document.layers)?event:null);" onKeyPress="WWHHandleKeyPress((document.all||document.getElementById||document.layers)?event:null);" onKeyUp="WWHHandleKeyUp((document.all||document.getElementById||document.layers)?event:null);">





 <script type="text/javascript" language="JavaScript1.2">
    <!--
      MGCInsertRTHeader(501);
    // -->
 </script>
 

<!--496,497,501-->
<!--EnDhEaDeR-->

<a name="MGCCIDP4 - Definition of the State Machine"></a>

<a name="wp6047"></a><h4 class="pHeading3">
  


4 - Definition of the State Machine
  </h4>


<!--4DefinitionoftheStateMachine-->


<a name="wp6048"></a><p class="pBody">
The protocol state machine should be defined such that the timing of the delivery of the protocol messages matches the activity in the HDL signals. Time is advanced via the command: <span style=" font-weight: bold;">@(posedge CLK);</span> or <span style=" font-weight: bold;">@(negedge CLK);</span>. When the protocol parameters reach the appropriate value, a message is written in the transaction database. At each transition, one and only one message is generated. The state machine advances from state to state, so that the valid protocol sequences are met. 
</p>


<a name="wp6049"></a><p class="pBody">
A transaction is defined as a full cycle of the state machine starting from the IDLE state and ending back in the IDLE state. All the messages issued on this full cycle constitute the transaction.
</p>


<a name="wp6768"></a><p class="pBody">
The time it takes the transaction to carry out this full cycle is called the <span style=" font-style: italic;">latency</span> of the transaction.
</p>


<a name="wp6051"></a><pre class="pCode">     (* protocol_SM *)</pre>


<a name="wp6052"></a><pre class="pCode">     always</pre>


<a name="wp6053"></a><pre class="pCode">     begin</pre>


<a name="wp6055"></a><pre class="pCode">     case (protocolState)</pre>


<a name="wp6057"></a><pre class="pCode">     <span style=" font-weight: bold;">IDLE :</span></pre>


<a name="wp6058"></a><pre class="pCode">         begin</pre>


<a name="wp6059"></a><pre class="pCode">           if ( (CS === 1&#39;b1) &amp;&amp; (CMD === 1&#39;b1) ) // WRITE</pre>


<a name="wp6060"></a><pre class="pCode">           begin</pre>


<a name="wp6061"></a><pre class="pCode">             protocolState = W_DATA;</pre>


<a name="wp6062"></a><pre class="pCode">             (* WRITE *) <span style=" font-weight: bold;">// WRITE Transaction</span></pre>


<a name="wp6063"></a><pre class="pCode">             G_WRITE (ADDR, PRIORITY, BURST, 1 &lt;&lt; SIZE);</pre>


<a name="wp6064"></a><pre class="pCode">             BurstCount = BURST;</pre>


<a name="wp6065"></a><pre class="pCode">           end</pre>


<a name="wp6066"></a><pre class="pCode">           else if ( (CS === 1&#39;b1) &amp;&amp; (CMD === 1&#39;b0) ) // READ</pre>


<a name="wp6067"></a><pre class="pCode">           begin</pre>


<a name="wp6068"></a><pre class="pCode">             protocolState = R_DATA;</pre>


<a name="wp6069"></a><pre class="pCode">             (* READ *) <span style=" font-weight: bold;">// READ Transaction</span></pre>


<a name="wp6070"></a><pre class="pCode">             G_READ (ADDR, PRIORITY, BURST, 1 &lt;&lt; SIZE);</pre>


<a name="wp6071"></a><pre class="pCode">             BurstCount = BURST;</pre>


<a name="wp6072"></a><pre class="pCode">           end</pre>


<a name="wp6073"></a><pre class="pCode">           else</pre>


<a name="wp6074"></a><pre class="pCode">           begin</pre>


<a name="wp6075"></a><pre class="pCode">             protocolState = IDLE;</pre>


<a name="wp6076"></a><pre class="pCode">             @ (negedge CLK);</pre>


<a name="wp6077"></a><pre class="pCode">           end</pre>


<a name="wp6078"></a><pre class="pCode">         end</pre>


<a name="wp6079"></a><pre class="pCode">     </pre>


<a name="wp6080"></a><pre class="pCode">     <span style=" font-weight: bold;">W_DATA :</span></pre>


<a name="wp6081"></a><pre class="pCode">         begin</pre>


<a name="wp6082"></a><pre class="pCode">           if (BurstCount == 0)</pre>


<a name="wp6083"></a><pre class="pCode">           begin</pre>


<a name="wp6084"></a><pre class="pCode">             protocolState = IDLE;</pre>


<a name="wp6085"></a><pre class="pCode">             END_TRANSACTION ();</pre>


<a name="wp6086"></a><pre class="pCode">             @ (negedge CLK);</pre>


<a name="wp6087"></a><pre class="pCode">           end</pre>


<a name="wp6088"></a><pre class="pCode">           else if (STATUS)</pre>


<a name="wp6089"></a><pre class="pCode">           begin</pre>


<a name="wp6090"></a><pre class="pCode">             protocolState = W_RESP;</pre>


<a name="wp6091"></a><pre class="pCode">             G_WRITE_DATA (wDATA);</pre>


<a name="wp6092"></a><pre class="pCode">             BurstCount = BurstCount - 1;</pre>


<a name="wp6093"></a><pre class="pCode">           end</pre>


<a name="wp6094"></a><pre class="pCode">           else</pre>


<a name="wp6095"></a><pre class="pCode">           begin</pre>


<a name="wp6096"></a><pre class="pCode">             protocolState = W_DATA;</pre>


<a name="wp6097"></a><pre class="pCode">             @ (negedge CLK);</pre>


<a name="wp6098"></a><pre class="pCode">           end</pre>


<a name="wp6099"></a><pre class="pCode">         end</pre>


<a name="wp6100"></a><pre class="pCode">     </pre>


<a name="wp6101"></a><pre class="pCode">     <span style=" font-weight: bold;">W_RESP :</span></pre>


<a name="wp6102"></a><pre class="pCode">         begin</pre>


<a name="wp6103"></a><pre class="pCode">           protocolState = W_DATA;</pre>


<a name="wp6104"></a><pre class="pCode">           g_write_resp (STATUS, BurstCount);</pre>


<a name="wp6105"></a><pre class="pCode">           @ (negedge CLK);</pre>


<a name="wp6106"></a><pre class="pCode">         end</pre>


<a name="wp6107"></a><pre class="pCode">     </pre>


<a name="wp6108"></a><pre class="pCode">     <span style=" font-weight: bold;">R_DATA :</span></pre>


<a name="wp6109"></a><pre class="pCode">         begin</pre>


<a name="wp6110"></a><pre class="pCode">           if (BurstCount == 0)</pre>


<a name="wp6111"></a><pre class="pCode">           begin</pre>


<a name="wp6112"></a><pre class="pCode">             protocolState = IDLE;</pre>


<a name="wp6113"></a><pre class="pCode">             END_TRANSACTION ();</pre>


<a name="wp6114"></a><pre class="pCode">             @ (negedge CLK);</pre>


<a name="wp6115"></a><pre class="pCode">           end</pre>


<a name="wp6116"></a><pre class="pCode">           else if (STATUS)</pre>


<a name="wp6117"></a><pre class="pCode">           begin</pre>


<a name="wp6118"></a><pre class="pCode">             protocolState = R_RESP;</pre>


<a name="wp6119"></a><pre class="pCode">             G_READ_DATA ();</pre>


<a name="wp6120"></a><pre class="pCode">             BurstCount = BurstCount - 1;</pre>


<a name="wp6121"></a><pre class="pCode">           end</pre>


<a name="wp6122"></a><pre class="pCode">           else</pre>


<a name="wp6123"></a><pre class="pCode">           begin</pre>


<a name="wp6124"></a><pre class="pCode">             protocolState = R_DATA;</pre>


<a name="wp6125"></a><pre class="pCode">             @ (negedge CLK);</pre>


<a name="wp6126"></a><pre class="pCode">           end</pre>


<a name="wp6127"></a><pre class="pCode">         end</pre>


<a name="wp6128"></a><pre class="pCode">     </pre>


<a name="wp6129"></a><pre class="pCode">     <span style=" font-weight: bold;">R_RESP :</span></pre>


<a name="wp6130"></a><pre class="pCode">         begin</pre>


<a name="wp6131"></a><pre class="pCode">           protocolState = R_DATA;</pre>


<a name="wp6132"></a><pre class="pCode">           g_read_resp (rDATA, STATUS, BurstCount);</pre>


<a name="wp6133"></a><pre class="pCode">           @ (negedge CLK);</pre>


<a name="wp6134"></a><pre class="pCode">         end</pre>


<a name="wp6135"></a><pre class="pCode">     </pre>


<a name="wp6136"></a><pre class="pCode">       endcase</pre>


<a name="wp6137"></a><pre class="pCode">     </pre>


<a name="wp6138"></a><pre class="pCode">     end</pre>


<a name="wp6719"></a><pre class="pCode">     </pre>


<a name="wp6142"></a><p class="pBody">
The state machine contains a case statement on the state variable. For each value of the state variable (IDLE, R_DATA etc.) a nested &quot;if&quot; statement can be used. The &quot;if&quot; statement can check a condition (for example, the value of a protocol parameter), and if the condition is met, one or more of the following may be done:
</p>


<a name="wp6143"></a>
<ul><li class="LL1BulSolid">setting the state variable</li></ul>
<a name="wp6477"></a>
<ul><li class="LL1BulSolid">issuing a message</li></ul>
<a name="wp6478"></a>
<ul><li class="LL1BulSolid">advancing time</li></ul>
<a name="wp6479"></a>
<ul><li class="LL1BulSolid">using any other SystemVerilog statements.</li></ul>
<a name="wp6148"></a><p class="pBody">
It is permissible to refrain from advancing the time in a message, if this is required by the protocol. This is necessary in cases where two or more messages need to be issued at the same time.
</p>


<a name="wp6150"></a><p class="pBody">
If the condition on the &quot;if&quot; statement is not met, an &quot;else if&quot; statement can be used with another condition, or an &quot;else&quot; statement with no explicit condition can be used. Each &quot;if&quot; or &quot;else&quot; statement (with or without condition) is called a <span style=" font-style: italic;">transition</span>.
</p>


<a name="wp6152"></a><p class="pBody">
The state machine defined should comply with the following rules:
</p>


<a name="wp6153"></a>
<ul><li class="LL1BulSolid">Cycles must start and end at the IDLE state</li></ul>
<a name="wp6154"></a>
<ul><li class="LL1BulSolid">Whenever you go from a state to a different state, you must issue a message</li></ul>
<a name="wp6155"></a>
<ul><li class="LL1BulSolid">Two messages cannot be issued during the same transition. (If two simultaneous messages are needed, create a new state and issue the two messages from different states without advancing time between them.)</li></ul>
<a name="wp6156"></a>
<ul><li class="LL1BulSolid">If you have a self transition (from/to the same state), time must be advanced with <span style=" font-weight: bold;">posedge/negedge</span></li></ul>
<a name="wp6157"></a>
<ul><li class="LL1BulSolid">The same message cannot be issued from two transitions that originate in the same state</li></ul>
<a name="wp6158"></a>
<ul><li class="LL1BulSolid">Only one &quot;else&quot; transition without an explicit condition can be included: namely, the last transition of the state. (The condition of this transition is the negation of all the previous conditions in the state.)</li></ul>
<a name="wp6159"></a>
<ul><li class="LL1BulSolid">Master and Slave messages should not be issued from the same state (with the exception of the IDLE state)</li></ul>




<script type="text/javascript" language="JavaScript1.2">
<!--
   PageTitle = "4 \- Definition of the State Machine";
   PDFLinkTitle = "4..Definition.of.the.State.Machine"
   ThisTopic = "4DefinitionoftheStateMachine";
   CurrentFile = "appendix_defining_c_protocols6.html";
   MGCSetDocumentVariables();
   MGCUpdateNavPane();
      MGCInsertRTFooter();
 // -->
 </script>



  </body>
</html>
